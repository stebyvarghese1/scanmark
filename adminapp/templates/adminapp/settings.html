{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Settings</title>
    <link rel="stylesheet" href="{% static 'adminapp/dashboard.css' %}">
    <style>
        .section { margin-bottom: 40px; }
        .course-list { margin-bottom: 20px; }
        .course-item { margin-bottom: 8px; }
        .add-btn, .generate-btn {
            background: #4e4499;
            color: #fff;
            border: none;
            padding: 7px 16px;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            margin-top: 10px;
        }
        .add-btn:hover, .generate-btn:hover { background: #5a4fcf; }
        .qr-section { margin-top: 40px; }
        #qr-code { margin-top: 20px; }
    </style>
</head>
<body>
    <header>
        <h1>ScanMark Admin Dashboard</h1>
    </header>
    <nav>
        <ul>
            <li><a href="{% url 'students_list' %}">Students List</a></li>
            <li><a href="#">Attendance</a></li>
            <li><a href="#">Reports</a></li>
            <li><a href="{% url 'settings' %}">Settings</a></li>
        </ul>
    </nav>
    <main>
        <section class="section">
            <h2>Courses</h2>
            <div class="course-list" id="course-list">
                {% for course in courses %}
                    <div class="course-item">{{ course.name }}</div>
                {% empty %}
                    <div>No courses found.</div>
                {% endfor %}
            </div>
            <form id="add-course-form" method="post" action="{% url 'add_course' %}">
                {% csrf_token %}
                <input type="text" name="name" placeholder="New course name" required>
                <button type="submit" class="add-btn">Add Course</button>
            </form>
        </section>
        <section class="section qr-section">
            <h2>Create ScanMark QR Code</h2>
            <form id="qr-form" autocomplete="off" onsubmit="event.preventDefault(); generateQRCode();">
                <div style="display: flex; flex-wrap: wrap; gap: 18px; align-items: center;">
                    <div>
                        <label for="qr-batch-from">Batch From:</label>
                        <input type="number" id="qr-batch-from" name="batch_from" min="1900" max="2100" style="width:90px;" required>
                    </div>
                    <div>
                        <label for="qr-batch-to">Batch To:</label>
                        <input type="number" id="qr-batch-to" name="batch_to" min="1900" max="2100" style="width:90px;" required>
                    </div>
                    <div>
                        <label for="qr-course">Course:</label>
                        <select id="qr-course" name="course" required>
                            <option value="">Select</option>
                            {% for course in courses %}
                                <option value="{{ course.id }}">{{ course.name }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <button type="submit" class="generate-btn" style="height:40px;margin-top:22px;">Generate QR Code</button>
                </div>
            </form>
            <div id="qr-code"></div>
        </section>
    </main>
    <script src="https://cdn.jsdelivr.net/npm/qrcode/build/qrcode.min.js"></script>
    <script>
    function generateQRCode() {
        if (!navigator.geolocation) {
            alert('Geolocation is not supported by your browser.');
            return;
        }
        const course = document.getElementById('qr-course').value;
        const batch_from = document.getElementById('qr-batch-from').value;
        const batch_to = document.getElementById('qr-batch-to').value;
        if (!course || !batch_from || !batch_to) {
            alert('Please select course and batch years.');
            return;
        }
        navigator.geolocation.getCurrentPosition(function(position) {
            const lat = position.coords.latitude;
            const lng = position.coords.longitude;
            const qrData = JSON.stringify({
                course: course,
                batch_from: batch_from,
                batch_to: batch_to,
                latitude: lat,
                longitude: lng
            });
            QRCode.toDataURL(qrData, { width: 256 }, function (err, url) {
                if (err) return alert('QR generation failed');
                document.getElementById('qr-code').innerHTML = `<img src="${url}" alt="QR Code"><br><small>Data: ${qrData}</small>`;
            });
        }, function() {
            alert('Unable to retrieve your location.');
        });
    }
    </script>
</body>
</html>